---
name: implementation-plans
description: Rules for creating and maintaining implementation plans in markdown format.
globs:
  - "docs/implementation_plans/**/*.md"
alwaysApply: true
---


# Implementation Plan Rules

Implementation plans document multi-step refactoring, feature work, or architectural changes. They must be structured, trackable, and avoid common failure modes.

## Location and Naming

- **Location**: All implementation plans must be placed in `docs/implementation_plans/`

- **Timestamp requirement**: All plan filenames **must include a date and time component placed immediately after the leading plan type marker**.
  - **Format**: `YYYYMMDD-HHMM` (24-hour clock, zero-padded)
  - **Timezone**: Author’s local timezone (or UTC if the repository standardizes on UTC)
- **Naming templates**:

### Master / ongoing plans

- **Pattern**: `MASTER-<YYYYMMDD-HHMM>-<kebab-case-description>.plan.md`
- **Example**: `MASTER-20260117-1412-mypy-type-safety-rollout.plan.md`

### Feature-specific plans

- Feature plans **do not use `MASTER`**, so the timestamp is placed at the **front**.
- **Pattern**: `<YYYYMMDD-HHMM>-<kebab-case-description>-<short-hash>.plan.md`
- **Example**: `20260117-1412-consolidate-repo-root-detection-c536724f.plan.md`

### Completed plans

- When **all steps are complete**, rename the file by adding a `FINISHED-` prefix.
- The timestamp must appear **immediately after `FINISHED`**.
- **Preferred patterns**:
  - `FINISHED-<YYYYMMDD-HHMM>-MASTER-<kebab-case-description>.plan.md`
  - `FINISHED-<YYYYMMDD-HHMM>-<kebab-case-description>-<short-hash>.plan.md`
- **Examples**:
  - `FINISHED-20260117-1412-MASTER-mypy-type-safety-rollout.plan.md`
  - `FINISHED-20260117-1412-consolidate-repo-root-detection-c536724f.plan.md`

## Required Structure

Every plan must include:

1. **Goal section**: Clear statement of what the plan achieves
2. **Status section**: Current completion status with visual indicators
3. **Steps section**: Broken down into discrete, actionable steps
4. **Success criteria**: Measurable outcomes for each step and overall goal

## Step Tracking

- **Mark steps with status indicators**:
  - ✅ `[x]` or `✅` for completed steps
  - ⏳ `[ ]` or `⏳` for pending/in-progress steps
  - Use consistent format throughout the document

- **Update status section** at the top of the document when steps are completed
- **Rename file** to include `FINISHED-` prefix when ALL steps are complete

## Summary Documents

Summary documents capture the final outcome of a completed implementation plan.

- **Location**:  
  All summary documents must be placed in `docs/implementation_plans/complete/`

- **Naming** (choose one, consistently):
  - `<plan-name>-SUMMARY.md`
  - `<AREA>-<SHORT-DESCRIPTION>-SUMMARY.md`  
  Examples:
  - `MASTER-mypy-type-safety-rollout-SUMMARY.md`
  - `CODE-QUALITY-mypy-rollout-SUMMARY.md`

- **Required content**:  
  Every summary document must include the following sections at the top of the file:

  - **Date**: `YYYY-MM-DD`
  - **Plan**: Reference to the completed plan file  
    (e.g. `FINISHED-MASTER-mypy-type-safety-rollout.plan.md`)
  - **Status**: One of:
    - `✅ Complete`
    - `⏳ Partial / Follow-up required`
    - `⚠️ Blocked / Deferred`

- **Purpose**:
  - Summarize *what was actually done* (not the full step-by-step plan)
  - Capture key decisions, trade-offs, and deviations from the original plan
  - Point to follow-up plans if work continues

- **Scope rules**:
  - One summary per completed plan
  - Do **not** edit summaries after completion except for minor clarifications

## Step Definition Requirements

Each step must:

- **Define what "done" means**: Include specific, measurable success criteria
- **Be atomic**: One step should accomplish one clear objective
- **Be actionable**: Clear enough that someone can implement it without ambiguity
- **Include verification**: How to confirm the step is complete

**Good step example**:

```markdown
### Step 1: Create src/core/ module structure

1. Create `src/core/__init__.py`
2. Create `src/core/tokens.py` with `is_token_known()` and `is_token_allowed()` functions
3. Move token validation logic from `orchestration/tokens.py`

**Success criteria**:
- `src/core/tokens.py` exists with all functions
- `uvx mypy src/core/tokens.py` passes with 0 errors
- All imports updated to use `from core.tokens import ...`
```

**Bad step example** (too vague):

```markdown
### Step 1: Refactor code
- Refactor the codebase to improve structure
```

## Avoid Common Failure Modes

- **❌ Do not write "fluffy" steps**: Avoid vague descriptions like "refactor code", "improve structure", "clean up" without defining what "done" means
- **❌ Do not create overlapping plans**: Before creating a new plan, search `docs/implementation_plans/` for existing plans covering the same goal. Update the existing plan instead (reuse-first principle)
- **❌ Do not skip verification**: Every step must have a way to verify completion
- **❌ Do not mix concerns**: Keep each plan focused on one coherent goal

## Plan Lifecycle

1. **Create**: When starting a new multi-step effort, create a plan following this structure
2. **Update**: As steps are completed, mark them and update the status section
3. **Complete**: When all steps are done, rename the file to include `FINISHED-` prefix
4. **Archive**: Completed plans remain in the directory for reference

## Example Plan Structure

```markdown
# Plan Title

## Goal

Clear statement of what this plan achieves.

## Status

**Last Updated**: YYYY-MM-DD

### Completed Steps
- ✅ Step 1: Description
- ✅ Step 2: Description

### Pending Steps
- ⏳ Step 3: Description
- ⏳ Step 4: Description

## Preconditions

What must be true before starting (if any).

## Steps

### Step 1: Clear Step Name

Detailed description of what needs to be done.

**Success criteria**:
- Specific, measurable outcome 1
- Specific, measurable outcome 2

### Step 2: Next Step Name

...

## Success Criteria (Overall)

- Overall goal 1 achieved
- Overall goal 2 achieved
```

## Reuse-First for Plans

Before creating a new plan:

1. **Search existing plans**: Check `docs/implementation_plans/` for plans covering similar goals
2. **Extend existing plan**: If a related plan exists, extend it with new steps rather than creating a duplicate
3. **Document decision**: If creating a new plan, briefly note why it's separate from existing plans
