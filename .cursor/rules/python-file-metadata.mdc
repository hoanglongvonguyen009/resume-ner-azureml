---
name: python-file-metadata
description: Add structured metadata to files with behavioral weight (scripts, workflows, tests, utilities).
globs:
  - "src/**/*.py"
  - "tests/**/*.py"
  - "tools/**/*.py"
alwaysApply: true
---

## File Metadata Rules

Files with **behavioral weight** (scripts, orchestration logic, tests, utilities) must declare a structured metadata block at the top of the file.

This metadata explains **intent, scope, and constraints** without requiring the reader to scan the entire file.

### Where Metadata Is Required

- **Entry-point scripts**: CLI, orchestration, jobs
- **Orchestration / workflow files**: HPO, benchmarking, training (see `@workflow-entrypoints.mdc`)
- **Test modules**: Unit, integration, E2E
- **Migration / cleanup scripts**: One-time or destructive logic
- **Shared utilities**: Clarifies intent, ownership, and safe reuse boundaries
- **Small pure helpers**: ‚ùå No metadata required (avoid noise)

### Metadata Format (Python)

Use a **comment-only docstring** at the top of the file. Do **not** include runtime logic or executable code.

```python
"""
@meta
name: hpo_local_sweep
type: script            # script | test | utility | migration
domain: hpo              # hpo | benchmarking | training | tracking | paths | conversion
responsibility:
  - Launch local HPO sweeps
  - Coordinate trial execution
inputs:
  - hpo.yaml
  - paths.yaml
outputs:
  - MLflow runs
  - study.db
tags:
  - entrypoint
  - mlflow
  - local-only
ci:
  runnable: true
  needs_gpu: false
  needs_cloud: false
lifecycle:
  status: active         # active | deprecated | legacy
"""
```

### Metadata for Test Files

Test metadata must clearly state **scope and exclusions**.

```python
"""
@meta
type: test
scope: unit              # unit | integration | e2e
domain: paths
covers:
  - path resolution
  - env overrides
excludes:
  - azure ml
  - gdrive
tags:
  - fast
  - ci-safe
"""
```

### Rules

- Metadata **augments**, not replaces, docstrings
- Keep metadata **minimal and truthful**
- Do not add metadata to every file blindly (only files with behavioral weight)
- When adding metadata to existing files, do so incrementally as you touch them
