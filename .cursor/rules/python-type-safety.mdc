---
name: python-type-safety-mypy
description: Enforce Python type safety using Mypy and automated fix loops.
globs:
  - "src/**/*.py"
  - "tests/**/*.py"
alwaysApply: true
---

## Type Safety Requirements

When modifying Python code in `src/` or `tests/`:

- **Prefer precise types**: Avoid `Any` unless absolutely necessary.
- **Use narrow types**: Prefer `TypedDict`, `dataclass`, `Protocol`, `Literal`, and generics over `dict[str, Any]`.
- If unsure about the exact shape, prefer a minimal `TypedDict` or a generic `Mapping[str, object]` and tighten it later; do not invent deep structures that may not match runtime reality.
- **Suppress narrowly**: If you must suppress an error, use `# type: ignore[error-code]` with a short comment explaining why.

## Mypy Enforcement Loop

When making Python changes:

1. Run: `uvx mypy src --show-error-codes` (or target a specific folder like `src/training/core`).
2. Fix all errors without changing runtime behavior.
3. Re-run Mypy until the targeted scope is clean.
4. Prefer adding shared types in `src/common/types.py` rather than duplicating annotations.

## Reference Configuration

See `@pyproject.toml` for Mypy strictness settings.
